<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cyber Zone Ultimate</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=Rajdhani:wght@500;700&family=Poppins:wght@300;600&display=swap" rel="stylesheet">
    <style>
        :root { --neon-blue: #00f3ff; --neon-pink: #ff00ff; --neon-purple: #bc13fe; --neon-green: #0aff0a; --neon-yellow: #ffd700; --bg-dark: #050510; --card-bg: rgba(20, 20, 35, 0.9); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { font-family: 'Poppins', sans-serif; margin: 0; background-color: var(--bg-dark); color: white; min-height: 100vh; padding-bottom: 80px; overflow-x: hidden; }
        .bg-fixed { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; background: radial-gradient(circle at 50% -20%, #1a1a3a 0%, #000 100%); }
        .cyber-grid { position: fixed; bottom: 0; left: 0; width: 200%; height: 60%; background: linear-gradient(transparent 0%, rgba(0, 243, 255, 0.1) 1%, transparent 2%), linear-gradient(90deg, transparent 0%, rgba(188, 19, 254, 0.1) 1%, transparent 2%); background-size: 40px 40px; transform: perspective(300px) rotateX(60deg); animation: gridMove 10s linear infinite; z-index: -1; pointer-events: none; mask-image: linear-gradient(to top, black 20%, transparent 100%); }
        @keyframes gridMove { 0% { background-position: 0 0; } 100% { background-position: 0 40px; } }
        
        .header { padding: 15px; text-align: center; background: rgba(0,0,0,0.6); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 100; border-bottom: 1px solid rgba(0,243,255,0.2); }
        h1 { font-family: 'Orbitron'; font-size: 1.8rem; margin: 0; background: linear-gradient(to right, var(--neon-blue), #fff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 10px var(--neon-blue); }
        .balance-box { font-family: 'Orbitron'; font-size: 1.2rem; margin-top: 5px; color: var(--neon-yellow); }

        .tab-content { display: none; padding: 15px; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .nav-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: #111; border-top: 2px solid var(--neon-purple); display: flex; justify-content: space-around; padding: 10px 0; z-index: 999; backdrop-filter: blur(10px); }
        .nav-item { color: #888; font-size: 0.8rem; text-align: center; flex: 1; cursor: pointer; transition: 0.3s; }
        .nav-item.active { color: var(--neon-blue); text-shadow: 0 0 10px var(--neon-blue); transform: translateY(-3px); }
        .nav-icon { font-size: 1.5rem; display: block; margin-bottom: 2px; }

        .container { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; }
        .card { background: var(--card-bg); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 12px; text-align: center; transition: 0.2s; }
        .card:active { transform: scale(0.98); border-color: var(--neon-green); }
        .btn { background: linear-gradient(135deg, var(--neon-blue), var(--neon-purple)); border: none; padding: 8px; width: 100%; border-radius: 6px; color: white; font-weight: bold; font-family: 'Orbitron'; font-size: 0.8rem; cursor: pointer; margin-top: 8px; }

        /* Mining Specific */
        .miner-area { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 60vh; }
        .coin-btn { width: 180px; height: 180px; border-radius: 50%; background: radial-gradient(circle, #2a2a5a, #000); border: 4px solid var(--neon-blue); box-shadow: 0 0 30px var(--neon-blue), inset 0 0 20px var(--neon-purple); display: flex; align-items: center; justify-content: center; font-size: 3.5rem; cursor: pointer; transition: 0.1s; position: relative; overflow: hidden; }
        .coin-btn:active { transform: scale(0.95); }
        .energy-bar { width: 80%; height: 10px; background: #333; border-radius: 5px; margin-top: 20px; overflow: hidden; border: 1px solid #555; }
        .energy-fill { height: 100%; background: linear-gradient(90deg, var(--neon-green), var(--neon-yellow)); width: 100%; transition: width 0.5s; }
        .float-num { position: absolute; color: white; font-weight: bold; font-size: 1.5rem; animation: floatUp 0.8s forwards; pointer-events: none; }
        @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-80px); opacity: 0; } }

        /* Shop */
        .shop-item { display: flex; align-items: center; justify-content: space-between; background: var(--card-bg); margin-bottom: 10px; padding: 15px; border-radius: 10px; border-left: 4px solid var(--neon-pink); }
        .buy-btn { background: #333; border: 1px solid var(--neon-yellow); color: var(--neon-yellow); padding: 5px 15px; border-radius: 20px; font-family: 'Orbitron'; font-size: 0.9rem; cursor: pointer; }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; display: none; align-items: center; justify-content: center; }
        .modal-box { background: #121225; border: 2px solid var(--neon-blue); width: 80%; max-width: 300px; padding: 20px; border-radius: 15px; text-align: center; animation: zoomIn 0.3s; }
    </style>
</head>
<body>
    <div class="bg-fixed"></div> <div class="cyber-grid"></div>
    <div class="header"><h1>CYBER ZONE</h1><div class="balance-box">üí∞ <span id="mainBalance">0</span></div></div>

    <div id="tab-games" class="tab-content active">
        <div class="container animate__animated animate__fadeIn">
            <div class="card"><h3>üé≤ Dice War</h3> <span style="font-size:0.7rem; color:#aaa">Win: 20 | Cost: 10</span><div style="font-size:2rem; margin:10px 0"><span id="dUser" style="color:cyan">?</span> vs <span id="dCpu" style="color:red">?</span></div><button class="btn" onclick="playDiceWar()">ROLL</button></div>
            <div class="card"><h3>üíé Slots</h3> <span style="font-size:0.7rem; color:#aaa">Jackpot: 100</span><div style="font-size:1.5rem; margin:10px 0" id="slotDisp">7 7 7</div><button class="btn" onclick="playSlot()">SPIN</button></div>
            <div class="card"><h3>üßÆ Math</h3> <span style="font-size:0.7rem; color:#aaa">Win: 10</span><div id="mQ" style="font-size:1.2rem; margin:5px">? + ?</div><input id="mAns" type="number" style="width:100%; background:#222; border:none; color:white; padding:5px; text-align:center"><button class="btn" onclick="checkMath()">SUBMIT</button></div>
        </div>
    </div>

    <div id="tab-mining" class="tab-content">
        <div class="miner-area">
            <div class="coin-btn" onclick="minePoint(event)">‚ö°</div>
            <div style="font-family:'Orbitron'; margin-top:10px; color:#aaa">Energy: <span id="enVal">100</span>/100</div>
            <div class="energy-bar"><div class="energy-fill" id="enBar"></div></div>
            <p style="margin-top:20px; color:#aaa; font-size:0.8rem">Tap to Mine Points!</p>
        </div>
    </div>

    <div id="tab-shop" class="tab-content">
        <div class="shop-item"><div class="shop-info"><h4 style="margin:0">üîã Max Energy</h4><p style="margin:0; font-size:0.8rem; color:#aaa">Limit: 200</p></div><button class="buy-btn" onclick="buyItem('battery', 500)">500 üí∞</button></div>
        <div class="shop-item"><div class="shop-info"><h4 style="margin:0">‚õèÔ∏è Turbo Tap</h4><p style="margin:0; font-size:0.8rem; color:#aaa">+2 Points/Tap</p></div><button class="buy-btn" onclick="buyItem('pickaxe', 1000)">1K üí∞</button></div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="switchTab('games', this)"><span class="nav-icon">üéÆ</span>GAME</div>
        <div class="nav-item" onclick="switchTab('mining', this)"><span class="nav-icon">‚õèÔ∏è</span>MINE</div>
        <div class="nav-item" onclick="switchTab('shop', this)"><span class="nav-icon">üõí</span>SHOP</div>
    </div>

    <div class="modal-overlay" id="modal"><div class="modal-box"><h2 id="mHead" style="color:#fff; margin:0">RESULT</h2><div id="mPts" style="font-size:2rem; margin:10px 0; font-weight:bold">+10</div><p id="mMsg" style="color:#aaa; font-size:0.8rem">Details</p><button class="btn" onclick="closeModal()">OK</button></div></div>

<script>
    const tg = window.Telegram.WebApp; tg.expand();
    let balance = 0, energy = 100, maxEnergy = 100, tapPower = 1, lastData = null;
    const haptic = (s) => tg.HapticFeedback && tg.HapticFeedback.impactOccurred(s || 'light');

    function switchTab(id, el) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.getElementById('tab-'+id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active'); haptic();
    }

    function minePoint(e) {
        if(energy <= 0) return;
        energy--; balance += tapPower; updateUI(); haptic('medium');
        let float = document.createElement('div'); float.className = 'float-num'; float.innerText = `+${tapPower}`;
        float.style.left = e.clientX + 'px'; float.style.top = e.clientY + 'px'; document.body.appendChild(float);
        setTimeout(()=>float.remove(), 800);
        if(balance % 20 === 0) tg.sendData(JSON.stringify({points: 0, msg: "KeepAlive"})); // Sync
    }

    setInterval(() => { if(energy < maxEnergy) { energy++; updateUI(); } }, 1000);
    function updateUI() { document.getElementById('mainBalance').innerText = balance; document.getElementById('enVal').innerText = energy; document.getElementById('enBar').style.width = (energy/maxEnergy*100) + '%'; }

    function buyItem(i, c) {
        if(balance < c) { showModal('LOW FUNDS', 0, 'Need Points', false); return; }
        balance -= c; if(i === 'battery') maxEnergy = 200; if(i === 'pickaxe') tapPower += 1;
        updateUI(); showModal('SUCCESS', -c, 'Upgraded!', true);
    }

    function showModal(h,p,m,win) {
        document.getElementById('mHead').innerText = h; document.getElementById('mPts').innerText = p>0?`+${p}`:p;
        document.getElementById('mPts').style.color = win?'var(--neon-green)':'var(--neon-red)';
        document.getElementById('mMsg').innerText = m; document.getElementById('modal').style.display='flex';
        if(win){confetti({particleCount:60,spread:50,origin:{y:0.6}});haptic('heavy')}else haptic('error');
        if(p!==0) lastData = {points: p, msg: m};
        balance += p; updateUI();
    }
    function closeModal() { document.getElementById('modal').style.display='none'; if(lastData){tg.sendData(JSON.stringify(lastData)); lastData=null;} }

    // Games
    function playDiceWar(){ let u=Math.floor(Math.random()*6)+1, c=Math.floor(Math.random()*6)+1; document.getElementById('dUser').innerText=u; document.getElementById('dCpu').innerText=c; if(u>c)showModal('WON',20,'Beat CPU',true); else if(u<c)showModal('LOST',-10,'Low Roll',false); else showModal('DRAW',0,'Same',false); }
    function playSlot(){ let s=['7','üçí','üçã'], r=[0,0,0].map(()=>s[Math.floor(Math.random()*3)]); document.getElementById('slotDisp').innerText=r.join(' '); let w=(r[0]==r[1]&&r[1]==r[2]); showModal(w?'JACKPOT':'LOSS',w?100:-10,'',w); }
    let mA,mB; function initMath(){ mA=Math.floor(Math.random()*10); mB=Math.floor(Math.random()*10); document.getElementById('mQ').innerText=`${mA} + ${mB}`; } initMath();
    function checkMath(){ let a=parseInt(document.getElementById('mAns').value); if(a==(mA+mB))showModal('OK',10,'Correct',true); else showModal('NO',-5,'Wrong',false); document.getElementById('mAns').value=''; initMath(); }
</script>
</body>
</html>
