<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cyber Arcade Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Poppins:wght@300;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --neon-blue: #00f3ff; --neon-pink: #ff00ff; --neon-green: #0aff0a;
            --bg-dark: #050510; --card-bg: rgba(20, 20, 35, 0.9);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body {
            font-family: 'Poppins', sans-serif; margin: 0; padding: 0;
            background-color: var(--bg-dark); color: white; min-height: 100vh;
            overflow-x: hidden; text-align: center;
        }

        /* --- UI LAYOUT --- */
        .header-bar {
            position: fixed; top: 0; left: 0; width: 100%; height: 60px;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(10px);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px; z-index: 100; border-bottom: 1px solid var(--neon-blue);
        }
        .total-score { font-family: 'Orbitron'; font-size: 1.2rem; color: var(--neon-green); }
        .save-btn {
            background: linear-gradient(90deg, #ff0055, #ff00cc); color: white;
            border: none; padding: 8px 15px; border-radius: 20px; font-weight: bold;
            font-size: 0.8rem; cursor: pointer;
        }

        /* MENU VIEW */
        #menu-view { padding: 80px 15px 100px; display: block; animation: fadeIn 0.5s; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        
        .game-card {
            background: var(--card-bg); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px; padding: 15px; display: flex; flex-direction: column;
            align-items: center; justify-content: center; height: 140px;
            transition: 0.2s; cursor: pointer; position: relative; overflow: hidden;
        }
        .game-card:active { transform: scale(0.95); border-color: var(--neon-blue); }
        .game-icon { font-size: 2.5rem; margin-bottom: 10px; }
        .game-title { font-size: 0.9rem; font-weight: bold; }
        .game-cost { font-size: 0.7rem; color: #aaa; margin-top: 5px; }

        /* GAME VIEW (FULL SCREEN) */
        #game-view {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-dark); z-index: 200; display: none;
            flex-direction: column; padding: 20px;
            animation: slideUp 0.3s;
        }
        .back-btn {
            align-self: flex-start; background: rgba(255,255,255,0.1); border: 1px solid white;
            color: white; padding: 8px 20px; border-radius: 20px; margin-bottom: 20px;
            cursor: pointer; font-size: 0.9rem;
        }
        .active-game-container {
            flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: var(--card-bg); border-radius: 20px; border: 1px solid var(--neon-blue);
            padding: 20px; width: 100%; box-shadow: 0 0 30px rgba(0, 243, 255, 0.1);
        }

        /* Common Game Elements */
        .btn {
            background: linear-gradient(135deg, var(--neon-blue), var(--neon-purple));
            border: none; padding: 15px; width: 80%; border-radius: 10px;
            color: white; font-weight: bold; font-size: 1.1rem; margin-top: 20px;
            font-family: 'Orbitron';
        }
        .result-disp { font-size: 1.2rem; margin: 15px 0; min-height: 30px; }
        input.cyber-input {
            background: #111; border: 1px solid #555; padding: 10px; color: white;
            text-align: center; font-size: 1.2rem; border-radius: 8px; width: 80%;
        }

        /* Specific Game Styles */
        .ttt-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; width: 200px; }
        .ttt-cell { height: 60px; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; font-size: 2rem; }
        .mem-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; width: 220px; }
        .mem-card { height: 50px; background: rgba(255,255,255,0.1); border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }

        /* Modal */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 300; display: none;
            align-items: center; justify-content: center;
        }
        .modal-box {
            background: #1a1a2e; border: 2px solid var(--neon-green);
            padding: 30px; border-radius: 20px; width: 85%; text-align: center;
        }

        @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="header-bar">
        <div class="total-score">üí∞ <span id="sessionScore">0</span></div>
        <button class="save-btn" onclick="exitApp()">CLAIM & EXIT</button>
    </div>

    <div id="menu-view">
        <h2 style="margin-bottom:20px;">CHOOSE GAME</h2>
        <div class="grid">
            <div class="game-card" onclick="openGame('lucky')">
                <div class="game-icon">üé∞</div>
                <div class="game-title">Lucky 7</div>
                <div class="game-cost">Win: 50 | Cost: 10</div>
            </div>
            <div class="game-card" onclick="openGame('math')">
                <div class="game-icon">üßÆ</div>
                <div class="game-title">Math Quiz</div>
                <div class="game-cost">Win: 10 | Cost: 5</div>
            </div>
            <div class="game-card" onclick="openGame('ttt')">
                <div class="game-icon">‚ùå‚≠ï</div>
                <div class="game-title">Tic Tac Toe</div>
                <div class="game-cost">Win: 20 | Cost: 10</div>
            </div>
            <div class="game-card" onclick="openGame('memory')">
                <div class="game-icon">üß†</div>
                <div class="game-title">Memory</div>
                <div class="game-cost">Win: 40 | Cost: 20</div>
            </div>
            <div class="game-card" onclick="openGame('spin')">
                <div class="game-icon">üé°</div>
                <div class="game-title">Spin Wheel</div>
                <div class="game-cost">Cost: 20</div>
            </div>
             <div class="game-card" onclick="openGame('dice')">
                <div class="game-icon">üé≤</div>
                <div class="game-title">Dice War</div>
                <div class="game-cost">Win: 20 | Cost: 10</div>
            </div>
             <div class="game-card" onclick="openGame('clicker')">
                <div class="game-icon">üñ±Ô∏è</div>
                <div class="game-title">Fast Click</div>
                <div class="game-cost">Win: 15 | Free</div>
            </div>
             <div class="game-card" onclick="openGame('rps')">
                <div class="game-icon">üëä</div>
                <div class="game-title">RPS Duel</div>
                <div class="game-cost">Win: 15 | Cost: 5</div>
            </div>
        </div>
        <div style="margin-top: 30px; font-size: 0.8rem; color: #666;">More games coming soon...</div>
    </div>

    <div id="game-view">
        <button class="back-btn" onclick="closeGame()">‚¨Ö BACK TO MENU</button>
        
        <div id="game-lucky" class="active-game-container" style="display:none;">
            <h1>üé∞ Lucky 7</h1>
            <p>Guess a number between 1-10</p>
            <input type="number" id="luckyIn" class="cyber-input" placeholder="?">
            <button class="btn" onclick="playLucky()">GUESS (-10)</button>
        </div>

        <div id="game-math" class="active-game-container" style="display:none;">
            <h1>üßÆ Math Quiz</h1>
            <h2 id="mathQ" style="font-size:2.5rem; margin:20px 0;">10 + 5</h2>
            <input type="number" id="mathIn" class="cyber-input" placeholder="Answer">
            <button class="btn" onclick="checkMath()">SUBMIT (-5)</button>
        </div>

        <div id="game-ttt" class="active-game-container" style="display:none;">
            <h1>‚ùå‚≠ï Tic Tac Toe</h1>
            <div class="ttt-grid" id="tttGrid"></div>
            <button class="btn" onclick="initTTT()">RESTART (-10)</button>
        </div>

        <div id="game-memory" class="active-game-container" style="display:none;">
            <h1>üß† Memory</h1>
            <div class="mem-grid" id="memGrid"></div>
            <button class="btn" onclick="initMemory()">START (-20)</button>
        </div>

        <div id="game-spin" class="active-game-container" style="display:none;">
            <h1>üé° Fortune Wheel</h1>
            <div id="wheel" style="width:150px; height:150px; border-radius:50%; background:conic-gradient(red,blue,green,gold,purple); border:5px solid white; transition: 3s ease-out;"></div>
            <div style="width:0; height:0; border-left:10px solid transparent; border-right:10px solid transparent; border-top:20px solid white; position:relative; top:-155px; z-index:5;"></div>
            <button class="btn" onclick="playSpin()">SPIN (-20)</button>
        </div>

        <div id="game-dice" class="active-game-container" style="display:none;">
            <h1>üé≤ Dice War</h1>
            <div style="display:flex; gap:30px; font-size:3rem; margin:20px 0;">
                <div style="color:cyan" id="d1">?</div> <div>VS</div> <div style="color:red" id="d2">?</div>
            </div>
            <button class="btn" onclick="playDice()">ROLL (-10)</button>
        </div>

        <div id="game-clicker" class="active-game-container" style="display:none;">
            <h1>üñ±Ô∏è Fast Clicker</h1>
            <p>Click 30 times in 3s!</p>
            <h1 id="clkScore" style="font-size:4rem; color:lime">0</h1>
            <button class="btn" id="btnClick" onmousedown="tapClick()">TAP TAP!</button>
        </div>

        <div id="game-rps" class="active-game-container" style="display:none;">
            <h1>üëä RPS Duel</h1>
            <div style="font-size:3rem; display:flex; gap:15px; margin:20px 0;">
                <div onclick="playRPS('r')">üëä</div>
                <div onclick="playRPS('p')">‚úã</div>
                <div onclick="playRPS('s')">‚úåÔ∏è</div>
            </div>
            <div id="rpsRes">Choose Move</div>
        </div>

    </div>

    <div class="modal-overlay" id="modal">
        <div class="modal-box">
            <h1 id="mHead">WIN!</h1>
            <h2 id="mPts" style="font-size:2.5rem; margin:10px 0;">+50</h2>
            <p id="mMsg">You are lucky!</p>
            <button class="btn" onclick="hideModal()">CONTINUE PLAYING</button>
        </div>
    </div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    let sessionPoints = 0;

    // --- NAVIGATION ---
    function openGame(id) {
        document.getElementById('menu-view').style.display = 'none';
        document.getElementById('game-view').style.display = 'flex';
        // Hide all games
        document.querySelectorAll('.active-game-container').forEach(el => el.style.display = 'none');
        // Show selected
        document.getElementById('game-'+id).style.display = 'flex';
        
        // Auto init some games
        if(id === 'math') initMath();
        if(id === 'ttt') initTTT();
        if(id === 'memory') initMemory();
        if(id === 'clicker') { clickCount=0; document.getElementById('clkScore').innerText='0'; }
    }

    function closeGame() {
        document.getElementById('game-view').style.display = 'none';
        document.getElementById('menu-view').style.display = 'block';
    }

    function updateScore(amount) {
        sessionPoints += amount;
        let el = document.getElementById('sessionScore');
        el.innerText = sessionPoints;
        el.style.color = sessionPoints >= 0 ? 'lime' : 'red';
    }

    function exitApp() {
        let msg = sessionPoints >= 0 ? `Won ${sessionPoints} Points` : `Lost ${sessionPoints} Points`;
        tg.sendData(JSON.stringify({ points: sessionPoints, msg: msg }));
    }

    // --- MODAL ---
    function showModal(title, pts, msg, win) {
        document.getElementById('mHead').innerText = title;
        document.getElementById('mPts').innerText = pts > 0 ? "+"+pts : pts;
        document.getElementById('mPts').style.color = win ? 'lime' : 'red';
        document.getElementById('mMsg').innerText = msg;
        document.getElementById('modal').style.display = 'flex';
        
        updateScore(pts);
        
        if(win) {
            tg.HapticFeedback.impactOccurred('heavy');
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
        } else {
            tg.HapticFeedback.impactOccurred('error');
        }
    }
    function hideModal() {
        document.getElementById('modal').style.display = 'none';
    }

    // ================= GAME LOGIC =================

    // 1. LUCKY 7
    function playLucky() {
        let v = parseInt(document.getElementById('luckyIn').value);
        if(!v || v<1 || v>10) return tg.showAlert("Enter 1-10");
        let r = Math.floor(Math.random()*10)+1;
        if(v === r) showModal("JACKPOT!", 50, "Number matched!", true);
        else showModal("MISSED", -10, "Result was "+r, false);
    }

    // 2. MATH
    let mA, mB;
    function initMath() { mA=Math.floor(Math.random()*10)+1; mB=Math.floor(Math.random()*10)+1; document.getElementById('mathQ').innerText = `${mA} + ${mB}`; document.getElementById('mathIn').value=''; }
    function checkMath() {
        let ans = parseInt(document.getElementById('mathIn').value);
        if(ans === mA+mB) { showModal("CORRECT", 10, "Math Whiz!", true); initMath(); }
        else showModal("WRONG", -5, "Bad Math!", false);
    }

    // 3. TTT
    let tb = Array(9).fill(null);
    function initTTT() {
        tb.fill(null); let g = document.getElementById('tttGrid'); g.innerHTML='';
        for(let i=0; i<9; i++) {
            let d = document.createElement('div'); d.className = 'ttt-cell';
            d.onclick = () => moveTTT(i, d); g.appendChild(d);
        }
    }
    function moveTTT(i, el) {
        if(tb[i]) return;
        tb[i] = 'X'; el.innerText = 'X'; el.style.color = 'cyan';
        // AI Move
        setTimeout(() => {
            let empty = tb.map((v,k) => v===null?k:null).filter(v=>v!==null);
            if(empty.length > 0) {
                let r = empty[Math.floor(Math.random()*empty.length)];
                tb[r] = 'O'; document.getElementById('tttGrid').children[r].innerText = 'O';
                document.getElementById('tttGrid').children[r].style.color = 'red';
                if(checkWin('O')) { showModal("DEFEAT", -10, "AI Won", false); return; }
            }
            if(checkWin('X')) showModal("VICTORY", 20, "You Won!", true);
            else if(!tb.includes(null)) showModal("DRAW", 0, "No Winner", false);
        }, 300);
    }
    function checkWin(p) { return [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]].some(c => tb[c[0]]==p && tb[c[1]]==p && tb[c[2]]==p); }

    // 4. MEMORY
    let mc=[], mok=0;
    function initMemory() {
        let icons = ['üöÄ','üöÄ','üíé','üíé','üî•','üî•','üíÄ','üíÄ'].sort(()=>Math.random()-0.5);
        let g = document.getElementById('memGrid'); g.innerHTML=''; mc=[]; mok=0;
        icons.forEach(i => {
            let d = document.createElement('div'); d.className = 'mem-card';
            d.onclick = () => {
                if(d.innerText || mc.length>=2) return;
                d.innerText = i; d.style.background = '#555'; mc.push(d);
                if(mc.length===2) setTimeout(checkMem, 500);
            };
            g.appendChild(d);
        });
    }
    function checkMem() {
        if(mc[0].innerText === mc[1].innerText) {
            mc.forEach(x => x.style.background = 'lime'); mok++;
            if(mok===4) showModal("CLEARED!", 40, "Great Memory", true);
        } else {
            mc.forEach(x => { x.innerText=''; x.style.background='rgba(255,255,255,0.1)'; });
        }
        mc = [];
    }

    // 5. SPIN
    function playSpin() {
        let w = document.getElementById('wheel');
        let deg = 1000 + Math.random()*2000;
        w.style.transform = `rotate(${deg}deg)`;
        setTimeout(() => {
            let win = Math.random() > 0.5;
            showModal(win?"LUCKY":"UNLUCKY", win?30:-20, win?"Big Prize!":"Nothing", win);
        }, 3200);
    }

    // 6. DICE
    function playDice() {
        let u = Math.floor(Math.random()*6)+1;
        let c = Math.floor(Math.random()*6)+1;
        document.getElementById('d1').innerText = u;
        document.getElementById('d2').innerText = c;
        if(u>c) showModal("WINNER", 20, `You: ${u} > CPU: ${c}`, true);
        else if(u<c) showModal("LOSER", -10, `You: ${u} < CPU: ${c}`, false);
        else showModal("DRAW", 0, "Roll Again", false);
    }

    // 7. CLICKER
    let clickCount=0, clickActive=false;
    function tapClick() {
        if(!clickActive) {
            clickActive = true; clickCount=0;
            document.getElementById('btnClick').innerText = "TAP TAP TAP!";
            setTimeout(() => {
                clickActive = false;
                document.getElementById('btnClick').innerText = "START";
                if(clickCount >= 30) showModal("GODLIKE", 15, `Clicks: ${clickCount}`, true);
                else showModal("TOO SLOW", 0, `Clicks: ${clickCount}/30`, false);
            }, 3000);
        } else {
            clickCount++;
            document.getElementById('clkScore').innerText = clickCount;
        }
    }

    // 8. RPS
    function playRPS(u) {
        let ops = ['r','p','s'];
        let c = ops[Math.floor(Math.random()*3)];
        let res = (u==c)?'d':((u=='r'&&c=='s')||(u=='p'&&c=='r')||(u=='s'&&c=='p'))?'w':'l';
        let txt = c === 'r' ? 'üëä' : c === 'p' ? '‚úã' : '‚úåÔ∏è';
        document.getElementById('rpsRes').innerText = "CPU chose " + txt;
        
        if(res === 'w') showModal("YOU WIN", 15, "CPU chose " + txt, true);
        else if(res === 'l') showModal("YOU LOSE", -5, "CPU chose " + txt, false);
        else showModal("DRAW", 0, "Try again", false);
    }

</script>
</body>
</html>
